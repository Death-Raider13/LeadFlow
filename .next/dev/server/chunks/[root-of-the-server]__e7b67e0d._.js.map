{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/LeadFlow/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // The \"setAll\" method was called from a Server Component.\n        }\n      },\n    },\n  })\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAAoF;QAC3G,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC5D;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/LeadFlow/app/api/leads/import/route.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from \"next/server\"\r\nimport { createClient } from \"@/lib/supabase/server\"\r\n\r\ninterface ImportBody {\r\n  leads: Record<string, string>[]\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = (await request.json()) as ImportBody\r\n    if (!body || !Array.isArray(body.leads)) {\r\n      return NextResponse.json({ error: \"Invalid request\" }, { status: 400 })\r\n    }\r\n\r\n    const supabase = await createClient()\r\n    const {\r\n      data: { user },\r\n    } = await supabase.auth.getUser()\r\n\r\n    if (!user) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n\r\n    // Map incoming rows to expected lead fields.\r\n    // Build `name` from common CSV headers: `name`, `full_name`, or `first_name` + `last_name`.\r\n    const rows = body.leads.map((r) => {\r\n      const first = (r.first_name || r.first || \"\").trim()\r\n      const last = (r.last_name || r.last || \"\").trim()\r\n      const nameFromParts = [first, last].filter(Boolean).join(\" \")\r\n      const name = (r.name || r.full_name || nameFromParts || \"\").trim() || \"Unknown\"\r\n\r\n      return {\r\n        name,\r\n        email: (r.email || r.email_address || null) as string | null,\r\n        phone: (r.phone || r.mobile || r.phone_number || null) as string | null,\r\n        source: (r.source || r.company || null) as string | null,\r\n        status: ((r.status as any) || \"new\") as string,\r\n        notes: (r.notes || r.note || null) as string | null,\r\n        user_id: user.id,\r\n      }\r\n    })\r\n\r\n    // Insert in batches to avoid huge single inserts\r\n    const chunkSize = 200\r\n    for (let i = 0; i < rows.length; i += chunkSize) {\r\n      const chunk = rows.slice(i, i + chunkSize)\r\n      const { error } = await supabase.from(\"leads\").insert(chunk)\r\n      if (error) {\r\n        console.error(\"Insert error:\", error)\r\n        return NextResponse.json({ error: error.message }, { status: 500 })\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({ success: true, inserted: rows.length })\r\n  } catch (err) {\r\n    console.error(err)\r\n    return NextResponse.json({ error: \"Import failed\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAMO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAQ,MAAM,QAAQ,IAAI;QAChC,IAAI,CAAC,QAAQ,CAAC,MAAM,OAAO,CAAC,KAAK,KAAK,GAAG;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,WAAW,MAAM,IAAA,2IAAY;QACnC,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE/B,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;QAE7E,6CAA6C;QAC7C,4FAA4F;QAC5F,MAAM,OAAO,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC;YAC3B,MAAM,QAAQ,CAAC,EAAE,UAAU,IAAI,EAAE,KAAK,IAAI,EAAE,EAAE,IAAI;YAClD,MAAM,OAAO,CAAC,EAAE,SAAS,IAAI,EAAE,IAAI,IAAI,EAAE,EAAE,IAAI;YAC/C,MAAM,gBAAgB;gBAAC;gBAAO;aAAK,CAAC,MAAM,CAAC,SAAS,IAAI,CAAC;YACzD,MAAM,OAAO,CAAC,EAAE,IAAI,IAAI,EAAE,SAAS,IAAI,iBAAiB,EAAE,EAAE,IAAI,MAAM;YAEtE,OAAO;gBACL;gBACA,OAAQ,EAAE,KAAK,IAAI,EAAE,aAAa,IAAI;gBACtC,OAAQ,EAAE,KAAK,IAAI,EAAE,MAAM,IAAI,EAAE,YAAY,IAAI;gBACjD,QAAS,EAAE,MAAM,IAAI,EAAE,OAAO,IAAI;gBAClC,QAAS,AAAC,EAAE,MAAM,IAAY;gBAC9B,OAAQ,EAAE,KAAK,IAAI,EAAE,IAAI,IAAI;gBAC7B,SAAS,KAAK,EAAE;YAClB;QACF;QAEA,iDAAiD;QACjD,MAAM,YAAY;QAClB,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,MAAM,EAAE,KAAK,UAAW;YAC/C,MAAM,QAAQ,KAAK,KAAK,CAAC,GAAG,IAAI;YAChC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,SAAS,MAAM,CAAC;YACtD,IAAI,OAAO;gBACT,QAAQ,KAAK,CAAC,iBAAiB;gBAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,OAAO,MAAM,OAAO;gBAAC,GAAG;oBAAE,QAAQ;gBAAI;YACnE;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,UAAU,KAAK,MAAM;QAAC;IAClE,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;IACrE;AACF"}}]
}